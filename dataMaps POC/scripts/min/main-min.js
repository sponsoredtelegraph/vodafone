!function(){function Zoom(e){$.extend(this,{$buttons:$(defaults.selectors.zoom.button),$info:$(defaults.selectors.zoom.info),scale:{max:50,currentShift:0},$container:e.$container,datamap:e.datamap}),this.init()}function Datamap(){console.log("this is",this),this.$container=$(defaults.selectors.map),this.instance=new Datamaps({scope:"world",responsive:!1,setProjection:function(e){var t=d3.geo.mercator().center([-10,55]).scale(650).translate([e.offsetWidth/2,e.offsetHeight/2]),a=d3.geo.path().projection(t);return{path:a,projection:t}},geographyConfig:{popupOnHover:!1,highlightOnHover:!1,borderColor:"#B1B8BD"},bubblesConfig:{borderWidth:0,borderColor:defaults.colors.white,popupOnHover:!0,radius:null,popupTemplate:function(e,t){return'<div class="hoverinfo"><strong>'+t.name+"</strong></div>"},fillOpacity:1,fillColor:defaults.colors.black,animate:!0,highlightOnHover:!0,highlightFillColor:defaults.colors.white,highlightBorderColor:defaults.colors.white,highlightBorderWidth:1,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},fills:{ALA:defaults.colors.red,ALB:defaults.colors.red,AND:defaults.colors.red,AUT:defaults.colors.red,BLR:defaults.colors.red,BEL:defaults.colors.red,BIH:defaults.colors.red,BGR:defaults.colors.red,HRV:defaults.colors.red,CYP:defaults.colors.red,CZE:defaults.colors.red,DNK:defaults.colors.red,EST:defaults.colors.red,FRO:defaults.colors.red,FIN:defaults.colors.red,FRA:defaults.colors.red,DEU:defaults.colors.red,GIB:defaults.colors.red,GRC:defaults.colors.red,HUN:defaults.colors.red,ISL:defaults.colors.red,IRL:defaults.colors.red,ITA:defaults.colors.red,LVA:defaults.colors.red,LIE:defaults.colors.red,LTU:defaults.colors.red,LUX:defaults.colors.red,MKD:defaults.colors.red,MLT:defaults.colors.red,MDA:defaults.colors.red,MCO:defaults.colors.red,NLD:defaults.colors.red,NOR:defaults.colors.red,POL:defaults.colors.red,PRT:defaults.colors.red,ROU:defaults.colors.red,SMR:defaults.colors.red,SRB:defaults.colors.red,SVK:defaults.colors.red,SVN:defaults.colors.red,ESP:defaults.colors.red,SWE:defaults.colors.red,TUR:defaults.colors.red,CHE:defaults.colors.red,UKR:defaults.colors.red,GBR:defaults.colors.red,VAT:defaults.colors.red,RSB:defaults.colors.red,IMN:defaults.colors.red,MNE:defaults.colors.red,kosovo:defaults.colors.red,GRL:defaults.colors.red,black:defaults.colors.black,defaultFill:defaults.colors.lightGrey},data:{ALA:{fillKey:"ALA"},ALB:{fillKey:"ALB"},AND:{fillKey:"AND"},AUT:{fillKey:"AUT"},BLR:{fillKey:"BLR"},BEL:{fillKey:"BEL"},BIH:{fillKey:"BIH"},BGR:{fillKey:"BGR"},HRV:{fillKey:"HRV"},CYP:{fillKey:"CYP"},CZE:{fillKey:"CZE"},DNK:{fillKey:"DNK"},EST:{fillKey:"EST"},FRO:{fillKey:"FRO"},FIN:{fillKey:"FIN"},FRA:{fillKey:"FRA"},DEU:{fillKey:"DEU"},GIB:{fillKey:"GIB"},GRC:{fillKey:"GRC"},HUN:{fillKey:"HUN"},ISL:{fillKey:"ISL"},IRL:{fillKey:"IRL"},ITA:{fillKey:"ITA"},LVA:{fillKey:"LVA"},LIE:{fillKey:"LIE"},LTU:{fillKey:"LTU"},LUX:{fillKey:"LUX"},MKD:{fillKey:"MKD"},MLT:{fillKey:"MLT"},MDA:{fillKey:"MDA"},MCO:{fillKey:"MCO"},NLD:{fillKey:"NLD"},NOR:{fillKey:"NOR"},POL:{fillKey:"POL"},PRT:{fillKey:"PRT"},ROU:{fillKey:"ROU"},SMR:{fillKey:"SMR"},SRB:{fillKey:"SRB"},SVK:{fillKey:"SVK"},SVN:{fillKey:"SVN"},ESP:{fillKey:"ESP"},SWE:{fillKey:"SWE"},TUR:{fillKey:"SVN"},CHE:{fillKey:"CHE"},UKR:{fillKey:"UKR"},GBR:{fillKey:"GBR"},VAT:{fillKey:"VAT"},RSB:{fillKey:"RSB"},IMN:{fillKey:"IMN"},MNE:{fillKey:"MNE"},kosovo:{fillKey:"kosovo"},GRL:{fillKey:"GRL"}},element:this.$container.get(0),projection:"mercator",done:this._handleMapReady.bind(this)})}function getBubbleData(){$.getJSON("scripts/dataMock.json",function(e){return bubblesArr.push(e),console.log(bubblesArr),bubblesArr})}var defaults=defaults||{},defaultOptions={scope:"world",responsive:!1,aspectRatio:.5625,projection:"equirectangular",dataType:"json",data:{},done:function(){},fills:{defaultFill:"#ABDDA4"},filters:{},geographyConfig:{dataUrl:null,hideAntarctica:!0,hideHawaiiAndAlaska:!1,borderWidth:1,borderOpacity:1,borderColor:"#FDFDFD",popupTemplate:function(e,t){return'<div class="hoverinfo"><strong>'+e.properties.name+"</strong></div>"},popupOnHover:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1},projectionConfig:{rotation:[97,0]},bubblesConfig:{borderWidth:2,borderOpacity:1,borderColor:"#FFFFFF",popupOnHover:!0,radius:null,popupTemplate:function(e,t){return'<div class="hoverinfo"><strong>'+t.name+"</strong></div>"},fillOpacity:.75,animate:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},arcConfig:{strokeColor:"#DD1C77",strokeWidth:1,arcSharpness:1,animationSpeed:600,popupOnHover:!1,popupTemplate:function(e,t){return t.origin&&t.destination&&t.origin.latitude&&t.origin.longitude&&t.destination.latitude&&t.destination.longitude?'<div class="hoverinfo"><strong>Arc</strong><br>Origin: '+JSON.stringify(t.origin)+"<br>Destination: "+JSON.stringify(t.destination)+"</div>":t.origin&&t.destination?'<div class="hoverinfo"><strong>Arc</strong><br>'+t.origin+" -> "+t.destination+"</div>":""}}};defaults={selectors:{zoom:{button:".zoom-button",info:".zoom-info"},subunit:".datamaps-subunit",map:"#main-map"},colors:{red:"rgba(164, 19, 9, 0.8)",white:"#FFFFFF",lightGrey:"#D0D0D0",black:"#000000"},time:40,animateOnce:!0},Zoom.prototype.init=function(){var e=this.datamap.svg.selectAll("path"),t=this.datamap.svg.selectAll(defaults.selectors.subunit),a=d3.selectAll(".datamaps-subunits");d3.selectAll("svg").attr("preserveAspectRatio","xMidYMid meet"),e.style("vector-effect","non-scaling-stroke"),t.call(d3.behavior.drag().on("dragend",function(){d3.event.sourceEvent.stopPropagation()})),this.scale.set=this._getScalesArray(),this.d3Zoom=d3.behavior.zoom().scaleExtent([1,this.scale.max]),setTimeout(function(){d3.selectAll(".mainMarkers").style("visibility","hidden"),d3.selectAll(".secondaryMarkers").style("visibility","hidden")},8),this._displayPercentage(1),this.listen()},Zoom.prototype.listen=function(){this.$buttons.off("click").on("click",this._handleClick.bind(this)),this.datamap.svg.call(this.d3Zoom.on("zoom",this._handleScroll.bind(this))).on("dblclick.zoom",null)},Zoom.prototype.reset=function(){this._shift("reset")},Zoom.prototype._toggleMainMarkers=function(e){var t=this;e>2?(d3.selectAll(".mainMarkers").style("visibility","visible"),t._animateMainMarkersIn(e)):(t._animateMainMarkersOut(),setTimeout(function(){d3.selectAll(".mainMarkers").style("visibility","hidden")},defaults.time))},Zoom.prototype._toggleSecondaryMarkers=function(e){var t=this;e>3?(d3.selectAll(".secondaryMarkers").style("visibility","visible"),t._animateSecondaryMarkersIn()):(t._animateSecondaryMarkersOut(),setTimeout(function(){d3.selectAll(".secondaryMarkers").style("visibility","hidden")},defaults.time))},Zoom.prototype._animateMainMarkersIn=function(scale){console.log("scale ",scale);var mainMarkers=d3.selectAll(".main-marker"),mainMarkersGroup=d3.selectAll(".mainMarkers"),mainMarkersText=d3.selectAll(".main-marker-text"),mainMarkersHeading=d3.selectAll(".main-marker-heading"),mainMarkersLink=d3.selectAll(".main-marker-link"),mainMarkersPin=d3.selectAll(".main-marker-pin");mainMarkersGroup.transition().duration(defaults.time).attr("transform","translate(0,0)scale("+scale+")rotate(180)");var delay=function(e,t){return t*defaults.time};mainMarkers.transition().duration(1.2*defaults.time).attr("r",function(e){return 46/scale}).attr("transform","translate( 0, "+eval(0-scale/1.5)+" )").style("fill-opacity",1).style("fill-opacity",1).ease("cube").delay(delay),mainMarkersText.transition().duration(1.2*defaults.time).attr("transform","translate( 0, "+eval(0-scale/1.5)+" )").style("font-size",function(){return 6-.25*scale}).style("fill-opacity",1).delay(delay),mainMarkersHeading.transition().duration(1.2*defaults.time).attr("transform","translate( 0, "+eval(0-scale/1.5)+" )").style("font-size",function(){return 6-.25*scale}).style("fill-opacity",1).delay(delay),mainMarkersPin.transition().duration(defaults.time).style("opacity",1).ease("cubic").delay(function(e,t){return 2.5*t*defaults.time}),mainMarkersLink.transition().duration(defaults.time).style("opacity",1).ease("cubic").delay(function(e,t){return 2.5*t*defaults.time})},Zoom.prototype._animateMainMarkersOut=function(){var e=d3.selectAll("circle.main-marker"),t=d3.selectAll(".main-marker-text"),a=d3.selectAll(".main-marker-heading"),i=d3.selectAll(".main-marker-link"),l=d3.selectAll(".main-marker-pin");e.transition().duration(defaults.time).style("fill-opacity",0).attr("r",function(e){return 2}).transition(),t.transition().duration(defaults.time/1.1).style("fill-opacity",0),a.transition().duration(defaults.time/1.1).style("fill-opacity/1.1",0),l.transition().duration(defaults.time).style("opacity",0),i.transition().duration(defaults.time).style("opacity",0)},Zoom.prototype._animateSecondaryMarkersIn=function(){var e=d3.selectAll("rect.secondary-marker");e.transition().duration(defaults.time).style("fill-opacity",1).ease("cubic")},Zoom.prototype._animateSecondaryMarkersOut=function(){var e=d3.selectAll("rect.secondary-marker");e.transition().duration(defaults.time).style("fill-opacity",0).ease("cubic")},Zoom.prototype._handleScroll=function(){var e=d3.event.translate,t=d3.event.scale,a=this._bound(e,t);this.scrolled=!0,this._update(a.translate,a.scale),this._toggleMainMarkers(t),this._toggleSecondaryMarkers(t)},Zoom.prototype._handleClick=function(e){var t=$(e.target).data("zoom");this._shift(t)},Zoom.prototype._shift=function(e){var t=[this.$container.width()/2,this.$container.height()/2],a=this.d3Zoom.translate(),i=[],l=[],r={x:a[0],y:a[1],k:this.d3Zoom.scale()},o;i=[(t[0]-r.x)/r.k,(t[1]-r.y)/r.k],"reset"==e?(r.k=1,this.scrolled=!0):r.k=this._getNextScale(e),l=[i[0]*r.k+r.x,i[1]*r.k+r.y],r.x+=t[0]-l[0],r.y+=t[1]-l[1],o=this._bound([r.x,r.y],r.k),this._animate(o.translate,o.scale)},Zoom.prototype._bound=function(e,t){var a=this.$container.width(),i=this.$container.height();return e[0]=Math.min(a/i*(t-1),Math.max(a*(1-t),e[0])),e[1]=Math.min(0,Math.max(i*(1-t),e[1])),{translate:e,scale:t}},Zoom.prototype._update=function(e,t){this.d3Zoom.translate(e).scale(t),this.datamap.svg.selectAll("g").attr("transform","translate("+e+")scale("+t+")"),this._displayPercentage(t)},Zoom.prototype._animate=function(e,t){var a=this,i=this.d3Zoom;d3.transition().duration(350).tween("zoom",function(){var l=d3.interpolate(i.translate(),e),r=d3.interpolate(i.scale(),t);return function(e){a._update(l(e),r(e))}})},Zoom.prototype._displayPercentage=function(e){var t;t=Math.round(Math.log(e)/Math.log(this.scale.max)*100),this.$info.text(t+"%")},Zoom.prototype._getScalesArray=function(){for(var e=[],t=Math.log(this.scale.max),a=0;10>=a;a++)e.push(Math.pow(Math.E,.1*a*t));return e},Zoom.prototype._getNextScale=function(e){var t=this.scale.set,a=this.d3Zoom.scale(),i=t.length-1,l,r=[];if(this.scrolled){for(l=0;i>=l;l++)r.push(Math.abs(t[l]-a));l=r.indexOf(Math.min.apply(null,r)),a>=t[l]&&i>l&&l++,"out"==e&&l>0&&l--,this.scrolled=!1}else l=this.scale.currentShift,"out"==e?l>0&&l--:i>l&&l++;return this.scale.currentShift=l,t[l]},Datamap.prototype._handleMapReady=function(e){this.zoom=new Zoom({$container:this.$container,datamap:e})};var redMap=new Datamap,bubblesArr=[];getBubbleData(),console.log("the bubble: ",getBubbleData());var hardcodedData=[{name:"United Kingdom",heading:"Visit Britain`s sandy beaches",radius:2,main:!0,country:"GBR",latitude:53.007347,longitude:-1.274414,fillKey:"black",href:"#"},{name:"Spain",heading:"Find the best Cava",radius:2,main:!1,centered:"ESP",country:"ESP",fillKey:"black",href:"#"},{name:"Germany",heading:"Break your speed record on the Autobahn",radius:2,main:!0,centered:"DEU",country:"DEU",fillKey:"black",href:"#"},{name:"France",heading:"Have you seen the lavender fields?",radius:2,main:!0,centered:"FRA",country:"FRA",fillKey:"black",href:"#"},{name:"Holland",heading:"The trendiest places to visit in Amsterdam",radius:2,main:!0,centered:"NLD",country:"NLD",fillKey:"black",href:"#"},{name:"Italy",heading:"Why Florence is the new fashion capital",radius:2,main:!0,centered:"ITA",country:"ITA",fillKey:"black",href:"#"},{name:"Croatia",heading:"Undisclosed island idylls",radius:2,main:!0,centered:"HRV",country:"HRV",fillKey:"black",href:"#"},{name:"Czech Republic",heading:"Find Franz Kafka`s secrets",radius:2,main:!1,centered:"CZE",country:"CZE",fillKey:"black",href:"#"},{name:"Austria",heading:"soundtrack by Johan Strauss",radius:2,main:!1,centered:"AUT",country:"AUT",fillKey:"black",href:"#"},{name:"Slovenia",heading:"Lorem Ipsum sit dolor amnet",radius:2,main:!1,centered:"SVN",country:"SVN",fillKey:"black",href:"#"},{name:"Switzerland",heading:"Lorem Ipsum sit dolor amnet",radius:2,main:!1,centered:"CHE",country:"CHE",fillKey:"black",href:"#"}];redMap.instance.bubbles(hardcodedData,{popupTemplate:function(e,t){return'<div class="hoverinfo main-info"> <div class="main-pin"></div>'+t.name+"</div>"}}),redMap.instance.mainMarkers(hardcodedData),redMap.instance.secondaryMarkers(hardcodedData),window.addEventListener("resize",function(){console.log("resize ",redMap.instance.resize),redMap.instance.resize()})}();