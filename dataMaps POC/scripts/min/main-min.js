!function(){function e(e){$.extend(this,{$buttons:$(o.selectors.zoom.button),$info:$(o.selectors.zoom.info),scale:{max:50,currentShift:0},$container:e.$container,datamap:e.datamap}),this.init()}function i(){console.log("this is",this),this.$container=$(o.selectors.map),this.instance=new Datamaps({scope:"world",responsive:!1,setProjection:function(e){var i=d3.geo.mercator().center([-10,55]).scale(650).translate([e.offsetWidth/2,e.offsetHeight/2]),t=d3.geo.path().projection(i);return{path:t,projection:i}},geographyConfig:{popupOnHover:!1,highlightOnHover:!1,borderColor:"#B1B8BD"},bubblesConfig:{borderWidth:0,borderColor:o.colors.white,popupOnHover:!0,radius:null,popupTemplate:function(e,i){return'<div class="hoverinfo"><strong>'+i.name+"</strong></div>"},fillOpacity:1,fillColor:o.colors.black,animate:!0,highlightOnHover:!0,highlightFillColor:o.colors.white,highlightBorderColor:o.colors.white,highlightBorderWidth:1,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},fills:{ALA:o.colors.red,ALB:o.colors.red,AND:o.colors.red,AUT:o.colors.red,BLR:o.colors.red,BEL:o.colors.red,BIH:o.colors.red,BGR:o.colors.red,HRV:o.colors.red,CYP:o.colors.red,CZE:o.colors.red,DNK:o.colors.red,EST:o.colors.red,FRO:o.colors.red,FIN:o.colors.red,FRA:o.colors.red,DEU:o.colors.red,GIB:o.colors.red,GRC:o.colors.red,HUN:o.colors.red,ISL:o.colors.red,IRL:o.colors.red,ITA:o.colors.red,LVA:o.colors.red,LIE:o.colors.red,LTU:o.colors.red,LUX:o.colors.red,MKD:o.colors.red,MLT:o.colors.red,MDA:o.colors.red,MCO:o.colors.red,NLD:o.colors.red,NOR:o.colors.red,POL:o.colors.red,PRT:o.colors.red,ROU:o.colors.red,SMR:o.colors.red,SRB:o.colors.red,SVK:o.colors.red,SVN:o.colors.red,ESP:o.colors.red,SWE:o.colors.red,CHE:o.colors.red,UKR:o.colors.red,GBR:o.colors.red,VAT:o.colors.red,RSB:o.colors.red,IMN:o.colors.red,MNE:o.colors.red,kosovo:o.colors.red,GRL:o.colors.red,black:o.colors.black,defaultFill:o.colors.lightGrey},data:{ALA:{fillKey:"ALA"},ALB:{fillKey:"ALB"},AND:{fillKey:"AND"},AUT:{fillKey:"AUT"},BLR:{fillKey:"BLR"},BEL:{fillKey:"BEL"},BIH:{fillKey:"BIH"},BGR:{fillKey:"BGR"},HRV:{fillKey:"HRV"},CYP:{fillKey:"CYP"},CZE:{fillKey:"CZE"},DNK:{fillKey:"DNK"},EST:{fillKey:"EST"},FRO:{fillKey:"FRO"},FIN:{fillKey:"FIN"},FRA:{fillKey:"FRA"},DEU:{fillKey:"DEU"},GIB:{fillKey:"GIB"},GRC:{fillKey:"GRC"},HUN:{fillKey:"HUN"},ISL:{fillKey:"ISL"},IRL:{fillKey:"IRL"},ITA:{fillKey:"ITA"},LVA:{fillKey:"LVA"},LIE:{fillKey:"LIE"},LTU:{fillKey:"LTU"},LUX:{fillKey:"LUX"},MKD:{fillKey:"MKD"},MLT:{fillKey:"MLT"},MDA:{fillKey:"MDA"},MCO:{fillKey:"MCO"},NLD:{fillKey:"NLD"},NOR:{fillKey:"NOR"},POL:{fillKey:"POL"},PRT:{fillKey:"PRT"},ROU:{fillKey:"ROU"},SMR:{fillKey:"SMR"},SRB:{fillKey:"SRB"},SVK:{fillKey:"SVK"},SVN:{fillKey:"SVN"},ESP:{fillKey:"ESP"},SWE:{fillKey:"SWE"},CHE:{fillKey:"CHE"},UKR:{fillKey:"UKR"},GBR:{fillKey:"GBR"},VAT:{fillKey:"VAT"},RSB:{fillKey:"RSB"},IMN:{fillKey:"IMN"},MNE:{fillKey:"MNE"},kosovo:{fillKey:"kosovo"},GRL:{fillKey:"GRL"}},element:this.$container.get(0),projection:"mercator",done:this._handleMapReady.bind(this)})}function t(){$.getJSON("scripts/dataMock.json",function(e){return n.push(e),console.log(n),n})}var o=o||{},r={scope:"world",responsive:!1,aspectRatio:.5625,projection:"equirectangular",dataType:"json",data:{},done:function(){},fills:{defaultFill:"#ABDDA4"},filters:{},geographyConfig:{dataUrl:null,hideAntarctica:!0,hideHawaiiAndAlaska:!1,borderWidth:1,borderOpacity:1,borderColor:"#FDFDFD",popupTemplate:function(e,i){return'<div class="hoverinfo"><strong>'+e.properties.name+"</strong></div>"},popupOnHover:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1},projectionConfig:{rotation:[97,0]},bubblesConfig:{borderWidth:2,borderOpacity:1,borderColor:"#FFFFFF",popupOnHover:!0,radius:null,popupTemplate:function(e,i){return'<div class="hoverinfo"><strong>'+i.name+"</strong></div>"},fillOpacity:.75,animate:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},arcConfig:{strokeColor:"#DD1C77",strokeWidth:1,arcSharpness:1,animationSpeed:600,popupOnHover:!1,popupTemplate:function(e,i){return i.origin&&i.destination&&i.origin.latitude&&i.origin.longitude&&i.destination.latitude&&i.destination.longitude?'<div class="hoverinfo"><strong>Arc</strong><br>Origin: '+JSON.stringify(i.origin)+"<br>Destination: "+JSON.stringify(i.destination)+"</div>":i.origin&&i.destination?'<div class="hoverinfo"><strong>Arc</strong><br>'+i.origin+" -> "+i.destination+"</div>":""}}};o={selectors:{zoom:{button:".zoom-button",info:".zoom-info"},subunit:".datamaps-subunit",map:"#main-map"},colors:{red:"#BB190D",white:"#FFFFFF",lightGrey:"#D0D0D0",black:"#000000"},time:40,animateOnce:!0},e.prototype.init=function(){var e=this.datamap.svg.selectAll("path"),i=this.datamap.svg.selectAll(o.selectors.subunit);e.style("vector-effect","non-scaling-stroke"),i.call(d3.behavior.drag().on("dragend",function(){d3.event.sourceEvent.stopPropagation()})),this.scale.set=this._getScalesArray(),this.d3Zoom=d3.behavior.zoom().scaleExtent([1,this.scale.max]),setTimeout(function(){d3.selectAll(".mainMarkers").style("visibility","hidden"),d3.selectAll(".secondaryMarkers").style("visibility","hidden")},8),this._displayPercentage(1),this.listen()},e.prototype.listen=function(){this.$buttons.off("click").on("click",this._handleClick.bind(this)),this.datamap.svg.call(this.d3Zoom.on("zoom",this._handleScroll.bind(this))).on("dblclick.zoom",null)},e.prototype.reset=function(){this._shift("reset")},e.prototype._toggleMainMarkers=function(e){var i=this;e>2?(d3.selectAll(".mainMarkers").style("visibility","visible"),i._animateMainMarkersIn(),setTimeout(function(){o.animateOnce=!1},10)):(i._animateMainMarkersOut(),setTimeout(function(){d3.selectAll(".mainMarkers").style("visibility","hidden")},o.time),setTimeout(function(){o.animateOnce=!0},10))},e.prototype._animateMainMarkersIn=function(){var e=d3.selectAll("circle.main-marker"),i=d3.selectAll(".main-marker-text"),t=d3.selectAll(".main-marker-heading"),r=d3.selectAll(".main-marker-pin"),l=function(e,i){return i*o.time};e.transition().duration(1.2*o.time).attr("r",function(e){return 23}).style("fill-opacity",1).ease("cube").delay(l),i.transition().duration(1.2*o.time).style("fill-opacity",1).delay(l),t.transition().duration(1.2*o.time).style("fill-opacity",1).delay(l),r.transition().duration(o.time).style("opacity",1).ease("cubic").delay(function(e,i){return 2.5*i*o.time})},e.prototype._animateMainMarkersOut=function(){var e=d3.selectAll("circle.main-marker");mainMarkersText=d3.selectAll(".main-marker-text"),mainMarkersHeading=d3.selectAll(".main-marker-heading"),mainMarkersPin=d3.selectAll(".main-marker-pin"),e.transition().duration(o.time).style("fill-opacity",0).attr("r",function(e){return 2}).transition(),mainMarkersText.transition().duration(o.time/1.1).style("fill-opacity",0),mainMarkersHeading.transition().duration(o.time/1.1).style("fill-opacity/1.1",0),mainMarkersPin.transition().duration(2*o.time).style("opacity",0)},e.prototype._toggleSecondaryMarkers=function(e){e>3?d3.selectAll(".secondaryMarkers").style("visibility","visible"):d3.selectAll(".secondaryMarkers").style("visibility","hidden")},e.prototype._handleScroll=function(){var e=d3.event.translate,i=d3.event.scale,t=this._bound(e,i);this.scrolled=!0,this._update(t.translate,t.scale),this._toggleMainMarkers(i),this._toggleSecondaryMarkers(i)},e.prototype._handleClick=function(e){var i=$(e.target).data("zoom");this._shift(i)},e.prototype._shift=function(e){var i=[this.$container.width()/2,this.$container.height()/2],t=this.d3Zoom.translate(),o=[],r=[],l={x:t[0],y:t[1],k:this.d3Zoom.scale()},n;o=[(i[0]-l.x)/l.k,(i[1]-l.y)/l.k],"reset"==e?(l.k=1,this.scrolled=!0):l.k=this._getNextScale(e),r=[o[0]*l.k+l.x,o[1]*l.k+l.y],l.x+=i[0]-r[0],l.y+=i[1]-r[1],n=this._bound([l.x,l.y],l.k),this._animate(n.translate,n.scale)},e.prototype._bound=function(e,i){var t=this.$container.width(),o=this.$container.height();return e[0]=Math.min(t/o*(i-1),Math.max(t*(1-i),e[0])),e[1]=Math.min(0,Math.max(o*(1-i),e[1])),{translate:e,scale:i}},e.prototype._update=function(e,i){this.d3Zoom.translate(e).scale(i),this.datamap.svg.selectAll("g").attr("transform","translate("+e+")scale("+i+")"),this._displayPercentage(i)},e.prototype._animate=function(e,i){var t=this,o=this.d3Zoom;d3.transition().duration(350).tween("zoom",function(){var r=d3.interpolate(o.translate(),e),l=d3.interpolate(o.scale(),i);return function(e){t._update(r(e),l(e))}})},e.prototype._displayPercentage=function(e){var i;i=Math.round(Math.log(e)/Math.log(this.scale.max)*100),this.$info.text(i+"%")},e.prototype._getScalesArray=function(){for(var e=[],i=Math.log(this.scale.max),t=0;10>=t;t++)e.push(Math.pow(Math.E,.1*t*i));return e},e.prototype._getNextScale=function(e){var i=this.scale.set,t=this.d3Zoom.scale(),o=i.length-1,r,l=[];if(this.scrolled){for(r=0;o>=r;r++)l.push(Math.abs(i[r]-t));r=l.indexOf(Math.min.apply(null,l)),t>=i[r]&&o>r&&r++,"out"==e&&r>0&&r--,this.scrolled=!1}else r=this.scale.currentShift,"out"==e?r>0&&r--:o>r&&r++;return this.scale.currentShift=r,i[r]},i.prototype._handleMapReady=function(i){this.zoom=new e({$container:this.$container,datamap:i})};var l=new i,n=[];t(),console.log("the bubble: ",t());var a=[{name:"United Kingdom",heading:"Visit Britain`s sandy beaches",radius:2,main:!0,country:"GBR",latitude:53.007347,longitude:-1.274414,fillKey:"black",href:"#"},{name:"Spain",heading:"Find the best Cava",radius:2,main:!1,centered:"ESP",country:"ESP",fillKey:"black",href:"#"},{name:"Germany",heading:"Break your speed record on the Autobahn",radius:2,main:!0,centered:"DEU",country:"DEU",fillKey:"black",href:"#"},{name:"France",heading:"Have you seen the lavender fields?",radius:2,main:!0,centered:"FRA",country:"FRA",fillKey:"black",href:"#"},{name:"Holland",heading:"The trendiest places to visit in Amsterdam",radius:2,main:!0,centered:"NLD",country:"NLD",fillKey:"black",href:"#"},{name:"Italy",heading:"Why Florence is the new fashion capital",radius:2,main:!0,centered:"ITA",country:"ITA",fillKey:"black",href:"#"},{name:"Croatia",heading:"Undisclosed island idylls",radius:2,main:!0,centered:"HRV",country:"HRV",fillKey:"black",href:"#"},{name:"Czech Republic",heading:"Find Franz Kafka`s secrets",radius:2,main:!1,centered:"CZE",country:"CZE",fillKey:"black",href:"#"},{name:"Austria",heading:"soundtrack by Johan Strauss",radius:2,main:!1,centered:"AUT",country:"AUT",fillKey:"black",href:"#"},{name:"Slovenia",heading:"Lorem Ipsum sit dolor amnet",radius:2,main:!1,centered:"SVN",country:"SVN",fillKey:"black",href:"#"},{name:"Switzerland",heading:"Lorem Ipsum sit dolor amnet",radius:2,main:!1,centered:"CHE",country:"CHE",fillKey:"black",href:"#"}];l.instance.bubbles(a,{popupTemplate:function(e,i){return'<div class="hoverinfo main-info"> <div class="main-pin"></div>'+i.name+"</div>"}}),l.instance.mainMarkers(a),l.instance.secondaryMarkers(a),window.addEventListener("resize",function(){console.log("resize ",l.instance.resize),l.instance.resize()})}();