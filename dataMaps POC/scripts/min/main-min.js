!function(){function e(e){$.extend(this,{$buttons:$(".zoom-button"),$info:$(".zoom-info"),scale:{max:50,currentShift:0},$container:e.$container,datamap:e.datamap}),this.init()}function t(){this.$container=$("#container"),this.instance=new Datamaps({scope:"world",responsive:!1,geographyConfig:{popupOnHover:!1,highlightOnHover:!1,borderColor:"#B1B8BD"},bubblesConfig:{borderWidth:0,borderColor:"#FFFFFF",popupOnHover:!0,radius:null,popupTemplate:function(e,t){return'<div class="hoverinfo"><strong>'+t.name+"</strong></div>"},fillOpacity:1,fillColor:"#000000",animate:!0,highlightOnHover:!0,highlightFillColor:"#FFFFFF",highlightBorderColor:"#FFFFFF",highlightBorderWidth:1,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},fills:{ALA:"#BB190D",ALB:"#BB190D",AND:"#BB190D",AUT:"#BB190D",BLR:"#BB190D",BEL:"#BB190D",BIH:"#BB190D",BGR:"#BB190D",HRV:"#BB190D",CYP:"#BB190D",CZE:"#BB190D",DNK:"#BB190D",EST:"#BB190D",FRO:"#BB190D",FIN:"#BB190D",FRA:"#BB190D",DEU:"#BB190D",GIB:"#BB190D",GRC:"#BB190D",HUN:"#BB190D",ISL:"#BB190D",IRL:"#BB190D",ITA:"#BB190D",LVA:"#BB190D",LIE:"#BB190D",LTU:"#BB190D",LUX:"#BB190D",MKD:"#BB190D",MLT:"#BB190D",MDA:"#BB190D",MCO:"#BB190D",NLD:"#BB190D",NOR:"#BB190D",POL:"#BB190D",PRT:"#BB190D",ROU:"#BB190D",SMR:"#BB190D",SRB:"#BB190D",SVK:"#BB190D",SVN:"#BB190D",ESP:"#BB190D",SWE:"#BB190D",CHE:"#BB190D",UKR:"#BB190D",GBR:"#BB190D",VAT:"#BB190D",RSB:"#BB190D",IMN:"#BB190D",MNE:"#BB190D",kosovo:"#BB190D",GRL:"#BB190D",black:"#000000",defaultFill:"#D0D0D0"},data:{ALA:{fillKey:"ALA"},ALB:{fillKey:"ALB"},AND:{fillKey:"AND"},AUT:{fillKey:"AUT"},BLR:{fillKey:"BLR"},BEL:{fillKey:"BEL"},BIH:{fillKey:"BIH"},BGR:{fillKey:"BGR"},HRV:{fillKey:"HRV"},CYP:{fillKey:"CYP"},CZE:{fillKey:"CZE"},DNK:{fillKey:"DNK"},EST:{fillKey:"EST"},FRO:{fillKey:"FRO"},FIN:{fillKey:"FIN"},FRA:{fillKey:"FRA"},DEU:{fillKey:"DEU"},GIB:{fillKey:"GIB"},GRC:{fillKey:"GRC"},HUN:{fillKey:"HUN"},ISL:{fillKey:"ISL"},IRL:{fillKey:"IRL"},ITA:{fillKey:"ITA"},LVA:{fillKey:"LVA"},LIE:{fillKey:"LIE"},LTU:{fillKey:"LTU"},LUX:{fillKey:"LUX"},MKD:{fillKey:"MKD"},MLT:{fillKey:"MLT"},MDA:{fillKey:"MDA"},MCO:{fillKey:"MCO"},NLD:{fillKey:"NLD"},NOR:{fillKey:"NOR"},POL:{fillKey:"POL"},PRT:{fillKey:"PRT"},ROU:{fillKey:"ROU"},SMR:{fillKey:"SMR"},SRB:{fillKey:"SRB"},SVK:{fillKey:"SVK"},SVN:{fillKey:"SVN"},ESP:{fillKey:"ESP"},SWE:{fillKey:"SWE"},CHE:{fillKey:"CHE"},UKR:{fillKey:"UKR"},GBR:{fillKey:"GBR"},VAT:{fillKey:"VAT"},RSB:{fillKey:"RSB"},IMN:{fillKey:"IMN"},MNE:{fillKey:"MNE"},kosovo:{fillKey:"kosovo"},GRL:{fillKey:"GRL"}},element:this.$container.get(0),projection:"mercator",done:this._handleMapReady.bind(this)})}function i(){$.getJSON("scripts/dataMock.json",function(e){return n.push(e),console.log(n),n})}e.prototype.init=function(){var e=this.datamap.svg.selectAll("path"),t=this.datamap.svg.selectAll(".datamaps-subunit");e.style("vector-effect","non-scaling-stroke"),t.call(d3.behavior.drag().on("dragend",function(){d3.event.sourceEvent.stopPropagation()})),this.scale.set=this._getScalesArray(),this.d3Zoom=d3.behavior.zoom().scaleExtent([1,this.scale.max]),this._displayPercentage(1),this.listen()},e.prototype.listen=function(){this.$buttons.off("click").on("click",this._handleClick.bind(this)),this.datamap.svg.call(this.d3Zoom.on("zoom",this._handleScroll.bind(this))).on("dblclick.zoom",null)},e.prototype.reset=function(){this._shift("reset")},e.prototype._handleScroll=function(){var e=d3.event.translate,t=d3.event.scale,i=this._bound(e,t);this.scrolled=!0,this._update(i.translate,i.scale)},e.prototype._handleClick=function(e){var t=$(e.target).data("zoom");this._shift(t)},e.prototype._shift=function(e){var t=[this.$container.width()/2,this.$container.height()/2],i=this.d3Zoom.translate(),l=[],n=[],o={x:i[0],y:i[1],k:this.d3Zoom.scale()},a;l=[(t[0]-o.x)/o.k,(t[1]-o.y)/o.k],"reset"==e?(o.k=1,this.scrolled=!0):o.k=this._getNextScale(e),n=[l[0]*o.k+o.x,l[1]*o.k+o.y],o.x+=t[0]-n[0],o.y+=t[1]-n[1],a=this._bound([o.x,o.y],o.k),this._animate(a.translate,a.scale)},e.prototype._bound=function(e,t){var i=this.$container.width(),l=this.$container.height();return e[0]=Math.min(i/l*(t-1),Math.max(i*(1-t),e[0])),e[1]=Math.min(0,Math.max(l*(1-t),e[1])),{translate:e,scale:t}},e.prototype._update=function(e,t){this.d3Zoom.translate(e).scale(t),this.datamap.svg.selectAll("g").attr("transform","translate("+e+")scale("+t+")"),this._displayPercentage(t)},e.prototype._animate=function(e,t){var i=this,l=this.d3Zoom;d3.transition().duration(350).tween("zoom",function(){var n=d3.interpolate(l.translate(),e),o=d3.interpolate(l.scale(),t);return function(e){i._update(n(e),o(e))}})},e.prototype._displayPercentage=function(e){var t;t=Math.round(Math.log(e)/Math.log(this.scale.max)*100),this.$info.text(t+"%")},e.prototype._getScalesArray=function(){for(var e=[],t=Math.log(this.scale.max),i=0;10>=i;i++)e.push(Math.pow(Math.E,.1*i*t));return e},e.prototype._getNextScale=function(e){var t=this.scale.set,i=this.d3Zoom.scale(),l=t.length-1,n,o=[];if(this.scrolled){for(n=0;l>=n;n++)o.push(Math.abs(t[n]-i));n=o.indexOf(Math.min.apply(null,o)),i>=t[n]&&l>n&&n++,"out"==e&&n>0&&n--,this.scrolled=!1}else n=this.scale.currentShift,"out"==e?n>0&&n--:l>n&&n++;return this.scale.currentShift=n,t[n]},t.prototype._handleMapReady=function(t){this.zoom=new e({$container:this.$container,datamap:t})};var l=new t,n=[];i(),console.log("the bubble: ",i());var o=[{name:"Vodafone in the UK",radius:2,centered:"GBR",country:"GBR",fillKey:"black"},{name:"The rain in Spain stays mainly on the Plane",radius:2,centered:"ESP",country:"ESP",fillKey:"black"},{name:"Sprechen sie Deutch?",radius:2,centered:"DEU",country:"DEU",fillKey:"black"},{name:"Parlez vous Francais?",radius:2,centered:"FRA",country:"FRA",fillKey:"black"}];l.instance.bubbles(o,{popupTemplate:function(e,t){return'<div class="hoverinfo main-info">'+t.name+"</div>"}}),window.addEventListener("resize",function(){console.log("resize ",l.instance.resize),l.instance.resize()})}();