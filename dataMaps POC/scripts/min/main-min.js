!function(){function e(e){$.extend(this,{$buttons:$(t.selectors.zoom.button),$info:$(t.selectors.zoom.info),scale:{max:50,currentShift:0},$container:e.$container,datamap:e.datamap}),this.init()}function o(){console.log("this is",this),this.$container=$(t.selectors.map),this.instance=new Datamaps({scope:"world",responsive:!1,setProjection:function(e){var o=d3.geo.mercator().center([-10,55]).scale(700).translate([e.offsetWidth/2,e.offsetHeight/2]),i=d3.geo.path().projection(o);return{path:i,projection:o}},geographyConfig:{popupOnHover:!1,highlightOnHover:!1,borderColor:"#B1B8BD"},bubblesConfig:{borderWidth:0,borderColor:t.colors.white,popupOnHover:!0,radius:null,popupTemplate:function(e,o){return'<div class="hoverinfo"><strong>'+o.name+"</strong></div>"},fillOpacity:1,fillColor:t.colors.black,animate:!0,highlightOnHover:!0,highlightFillColor:t.colors.white,highlightBorderColor:t.colors.white,highlightBorderWidth:1,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},fills:{ALA:t.colors.red,ALB:t.colors.red,AND:t.colors.red,AUT:t.colors.red,BLR:t.colors.red,BEL:t.colors.red,BIH:t.colors.red,BGR:t.colors.red,HRV:t.colors.red,CYP:t.colors.red,CZE:t.colors.red,DNK:t.colors.red,EST:t.colors.red,FRO:t.colors.red,FIN:t.colors.red,FRA:t.colors.red,DEU:t.colors.red,GIB:t.colors.red,GRC:t.colors.red,HUN:t.colors.red,ISL:t.colors.red,IRL:t.colors.red,ITA:t.colors.red,LVA:t.colors.red,LIE:t.colors.red,LTU:t.colors.red,LUX:t.colors.red,MKD:t.colors.red,MLT:t.colors.red,MDA:t.colors.red,MCO:t.colors.red,NLD:t.colors.red,NOR:t.colors.red,POL:t.colors.red,PRT:t.colors.red,ROU:t.colors.red,SMR:t.colors.red,SRB:t.colors.red,SVK:t.colors.red,SVN:t.colors.red,ESP:t.colors.red,SWE:t.colors.red,CHE:t.colors.red,UKR:t.colors.red,GBR:t.colors.red,VAT:t.colors.red,RSB:t.colors.red,IMN:t.colors.red,MNE:t.colors.red,kosovo:t.colors.red,GRL:t.colors.red,black:t.colors.black,defaultFill:t.colors.lightGrey},data:{ALA:{fillKey:"ALA"},ALB:{fillKey:"ALB"},AND:{fillKey:"AND"},AUT:{fillKey:"AUT"},BLR:{fillKey:"BLR"},BEL:{fillKey:"BEL"},BIH:{fillKey:"BIH"},BGR:{fillKey:"BGR"},HRV:{fillKey:"HRV"},CYP:{fillKey:"CYP"},CZE:{fillKey:"CZE"},DNK:{fillKey:"DNK"},EST:{fillKey:"EST"},FRO:{fillKey:"FRO"},FIN:{fillKey:"FIN"},FRA:{fillKey:"FRA"},DEU:{fillKey:"DEU"},GIB:{fillKey:"GIB"},GRC:{fillKey:"GRC"},HUN:{fillKey:"HUN"},ISL:{fillKey:"ISL"},IRL:{fillKey:"IRL"},ITA:{fillKey:"ITA"},LVA:{fillKey:"LVA"},LIE:{fillKey:"LIE"},LTU:{fillKey:"LTU"},LUX:{fillKey:"LUX"},MKD:{fillKey:"MKD"},MLT:{fillKey:"MLT"},MDA:{fillKey:"MDA"},MCO:{fillKey:"MCO"},NLD:{fillKey:"NLD"},NOR:{fillKey:"NOR"},POL:{fillKey:"POL"},PRT:{fillKey:"PRT"},ROU:{fillKey:"ROU"},SMR:{fillKey:"SMR"},SRB:{fillKey:"SRB"},SVK:{fillKey:"SVK"},SVN:{fillKey:"SVN"},ESP:{fillKey:"ESP"},SWE:{fillKey:"SWE"},CHE:{fillKey:"CHE"},UKR:{fillKey:"UKR"},GBR:{fillKey:"GBR"},VAT:{fillKey:"VAT"},RSB:{fillKey:"RSB"},IMN:{fillKey:"IMN"},MNE:{fillKey:"MNE"},kosovo:{fillKey:"kosovo"},GRL:{fillKey:"GRL"}},element:this.$container.get(0),projection:"mercator",done:this._handleMapReady.bind(this)})}function i(){$.getJSON("scripts/dataMock.json",function(e){return n.push(e),console.log(n),n})}var t=t||{},r={scope:"world",responsive:!1,aspectRatio:.5625,projection:"equirectangular",dataType:"json",data:{},done:function(){},fills:{defaultFill:"#ABDDA4"},filters:{},geographyConfig:{dataUrl:null,hideAntarctica:!0,hideHawaiiAndAlaska:!1,borderWidth:1,borderOpacity:1,borderColor:"#FDFDFD",popupTemplate:function(e,o){return'<div class="hoverinfo"><strong>'+e.properties.name+"</strong></div>"},popupOnHover:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1},projectionConfig:{rotation:[97,0]},bubblesConfig:{borderWidth:2,borderOpacity:1,borderColor:"#FFFFFF",popupOnHover:!0,radius:null,popupTemplate:function(e,o){return'<div class="hoverinfo"><strong>'+o.name+"</strong></div>"},fillOpacity:.75,animate:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},arcConfig:{strokeColor:"#DD1C77",strokeWidth:1,arcSharpness:1,animationSpeed:600,popupOnHover:!1,popupTemplate:function(e,o){return o.origin&&o.destination&&o.origin.latitude&&o.origin.longitude&&o.destination.latitude&&o.destination.longitude?'<div class="hoverinfo"><strong>Arc</strong><br>Origin: '+JSON.stringify(o.origin)+"<br>Destination: "+JSON.stringify(o.destination)+"</div>":o.origin&&o.destination?'<div class="hoverinfo"><strong>Arc</strong><br>'+o.origin+" -> "+o.destination+"</div>":""}}};t={selectors:{zoom:{button:".zoom-button",info:".zoom-info"},subunit:".datamaps-subunit",map:"#main-map"},colors:{red:"#BB190D",white:"#FFFFFF",lightGrey:"#D0D0D0",black:"#000000"}},e.prototype.init=function(){var e=this.datamap.svg.selectAll("path"),o=this.datamap.svg.selectAll(t.selectors.subunit);e.style("vector-effect","non-scaling-stroke"),o.call(d3.behavior.drag().on("dragend",function(){d3.event.sourceEvent.stopPropagation()})),this.scale.set=this._getScalesArray(),this.d3Zoom=d3.behavior.zoom().scaleExtent([1,this.scale.max]),this._displayPercentage(1),this.listen()},e.prototype.listen=function(){this.$buttons.off("click").on("click",this._handleClick.bind(this)),this.datamap.svg.call(this.d3Zoom.on("zoom",this._handleScroll.bind(this))).on("dblclick.zoom",null)},e.prototype.reset=function(){this._shift("reset")},e.prototype._handleScroll=function(){var e=d3.event.translate,o=d3.event.scale,i=this._bound(e,o);this.scrolled=!0,this._update(i.translate,i.scale)},e.prototype._handleClick=function(e){var o=$(e.target).data("zoom");this._shift(o)},e.prototype._shift=function(e){var o=[this.$container.width()/2,this.$container.height()/2],i=this.d3Zoom.translate(),t=[],r=[],l={x:i[0],y:i[1],k:this.d3Zoom.scale()},n;t=[(o[0]-l.x)/l.k,(o[1]-l.y)/l.k],"reset"==e?(l.k=1,this.scrolled=!0):l.k=this._getNextScale(e),r=[t[0]*l.k+l.x,t[1]*l.k+l.y],l.x+=o[0]-r[0],l.y+=o[1]-r[1],n=this._bound([l.x,l.y],l.k),this._animate(n.translate,n.scale)},e.prototype._bound=function(e,o){var i=this.$container.width(),t=this.$container.height();return e[0]=Math.min(i/t*(o-1),Math.max(i*(1-o),e[0])),e[1]=Math.min(0,Math.max(t*(1-o),e[1])),{translate:e,scale:o}},e.prototype._update=function(e,o){this.d3Zoom.translate(e).scale(o),this.datamap.svg.selectAll("g").attr("transform","translate("+e+")scale("+o+")"),this._displayPercentage(o)},e.prototype._animate=function(e,o){var i=this,t=this.d3Zoom;d3.transition().duration(350).tween("zoom",function(){var r=d3.interpolate(t.translate(),e),l=d3.interpolate(t.scale(),o);return function(e){i._update(r(e),l(e))}})},e.prototype._displayPercentage=function(e){var o;o=Math.round(Math.log(e)/Math.log(this.scale.max)*100),this.$info.text(o+"%")},e.prototype._getScalesArray=function(){for(var e=[],o=Math.log(this.scale.max),i=0;10>=i;i++)e.push(Math.pow(Math.E,.1*i*o));return e},e.prototype._getNextScale=function(e){var o=this.scale.set,i=this.d3Zoom.scale(),t=o.length-1,r,l=[];if(this.scrolled){for(r=0;t>=r;r++)l.push(Math.abs(o[r]-i));r=l.indexOf(Math.min.apply(null,l)),i>=o[r]&&t>r&&r++,"out"==e&&r>0&&r--,this.scrolled=!1}else r=this.scale.currentShift,"out"==e?r>0&&r--:t>r&&r++;return this.scale.currentShift=r,o[r]},o.prototype._handleMapReady=function(o){this.zoom=new e({$container:this.$container,datamap:o})};var l=new o,n=[];i(),console.log("the bubble: ",i());var a=[{name:"United Kingdom",heading:"Visit Britain`s sandy beaches",radius:2,main:!0,centered:"GBR",country:"GBR",fillKey:"black",href:"#"},{name:"Spain",heading:"Find the best Cava",radius:2,main:!1,centered:"ESP",country:"ESP",fillKey:"black",href:"#"},{name:"Germany",heading:"Break your speed record on the Autobahn",radius:2,main:!0,centered:"DEU",country:"DEU",fillKey:"black",href:"#"},{name:"France",heading:"Have you seen the lavender fields?",radius:2,main:!0,centered:"FRA",country:"FRA",fillKey:"black",href:"#"},{name:"Holland",heading:"The trendiest places to visit in Amsterdam",radius:2,main:!0,centered:"NLD",country:"NLD",fillKey:"black",href:"#"},{name:"Italy",heading:"Why Florence is the new fashion capital",radius:2,main:!0,centered:"ITA",country:"ITA",fillKey:"black",href:"#"},{name:"Croatia",heading:"Undisclosed island idylls",radius:2,main:!0,centered:"HRV",country:"HRV",fillKey:"black",href:"#"},{name:"Czech Republic",heading:"Find Franz Kafka`s secrets",radius:2,main:!1,centered:"CZE",country:"CZE",fillKey:"black",href:"#"},{name:"Austria",heading:"soundtrack by Johan Strauss",radius:2,main:!1,centered:"AUT",country:"AUT",fillKey:"black",href:"#"},{name:"Slovenia",heading:"Lorem Ipsum sit dolor amnet",radius:2,main:!1,centered:"SVN",country:"SVN",fillKey:"black",href:"#"},{name:"Switzerland",heading:"Lorem Ipsum sit dolor amnet",radius:2,main:!1,centered:"CHE",country:"CHE",fillKey:"black",href:"#"}];l.instance.bubbles(a,{popupTemplate:function(e,o){return'<div class="hoverinfo main-info"> <div class="main-pin"></div>'+o.name+"</div>"}}),l.instance.mainMarkers(a),l.instance.secondaryMarkers(a),window.addEventListener("resize",function(){console.log("resize ",l.instance.resize),l.instance.resize()})}();