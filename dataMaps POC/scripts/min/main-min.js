!function(){function e(e){$.extend(this,{$buttons:$(i.selectors.zoom.button),$info:$(i.selectors.zoom.info),scale:{max:50,currentShift:0},$container:e.$container,datamap:e.datamap}),this.init()}function o(){console.log("this is",this),this.$container=$(i.selectors.map),this.instance=new Datamaps({scope:"world",responsive:!1,setProjection:function(e){var o=d3.geo.mercator().center([-10,55]).scale(700).translate([e.offsetWidth/2,e.offsetHeight/2]),t=d3.geo.path().projection(o);return{path:t,projection:o}},geographyConfig:{popupOnHover:!1,highlightOnHover:!1,borderColor:"#B1B8BD"},bubblesConfig:{borderWidth:0,borderColor:i.colors.white,popupOnHover:!0,radius:null,popupTemplate:function(e,o){return'<div class="hoverinfo"><strong>'+o.name+"</strong></div>"},fillOpacity:1,fillColor:i.colors.black,animate:!0,highlightOnHover:!0,highlightFillColor:i.colors.white,highlightBorderColor:i.colors.white,highlightBorderWidth:1,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},fills:{ALA:i.colors.red,ALB:i.colors.red,AND:i.colors.red,AUT:i.colors.red,BLR:i.colors.red,BEL:i.colors.red,BIH:i.colors.red,BGR:i.colors.red,HRV:i.colors.red,CYP:i.colors.red,CZE:i.colors.red,DNK:i.colors.red,EST:i.colors.red,FRO:i.colors.red,FIN:i.colors.red,FRA:i.colors.red,DEU:i.colors.red,GIB:i.colors.red,GRC:i.colors.red,HUN:i.colors.red,ISL:i.colors.red,IRL:i.colors.red,ITA:i.colors.red,LVA:i.colors.red,LIE:i.colors.red,LTU:i.colors.red,LUX:i.colors.red,MKD:i.colors.red,MLT:i.colors.red,MDA:i.colors.red,MCO:i.colors.red,NLD:i.colors.red,NOR:i.colors.red,POL:i.colors.red,PRT:i.colors.red,ROU:i.colors.red,SMR:i.colors.red,SRB:i.colors.red,SVK:i.colors.red,SVN:i.colors.red,ESP:i.colors.red,SWE:i.colors.red,CHE:i.colors.red,UKR:i.colors.red,GBR:i.colors.red,VAT:i.colors.red,RSB:i.colors.red,IMN:i.colors.red,MNE:i.colors.red,kosovo:i.colors.red,GRL:i.colors.red,black:i.colors.black,defaultFill:i.colors.lightGrey},data:{ALA:{fillKey:"ALA"},ALB:{fillKey:"ALB"},AND:{fillKey:"AND"},AUT:{fillKey:"AUT"},BLR:{fillKey:"BLR"},BEL:{fillKey:"BEL"},BIH:{fillKey:"BIH"},BGR:{fillKey:"BGR"},HRV:{fillKey:"HRV"},CYP:{fillKey:"CYP"},CZE:{fillKey:"CZE"},DNK:{fillKey:"DNK"},EST:{fillKey:"EST"},FRO:{fillKey:"FRO"},FIN:{fillKey:"FIN"},FRA:{fillKey:"FRA"},DEU:{fillKey:"DEU"},GIB:{fillKey:"GIB"},GRC:{fillKey:"GRC"},HUN:{fillKey:"HUN"},ISL:{fillKey:"ISL"},IRL:{fillKey:"IRL"},ITA:{fillKey:"ITA"},LVA:{fillKey:"LVA"},LIE:{fillKey:"LIE"},LTU:{fillKey:"LTU"},LUX:{fillKey:"LUX"},MKD:{fillKey:"MKD"},MLT:{fillKey:"MLT"},MDA:{fillKey:"MDA"},MCO:{fillKey:"MCO"},NLD:{fillKey:"NLD"},NOR:{fillKey:"NOR"},POL:{fillKey:"POL"},PRT:{fillKey:"PRT"},ROU:{fillKey:"ROU"},SMR:{fillKey:"SMR"},SRB:{fillKey:"SRB"},SVK:{fillKey:"SVK"},SVN:{fillKey:"SVN"},ESP:{fillKey:"ESP"},SWE:{fillKey:"SWE"},CHE:{fillKey:"CHE"},UKR:{fillKey:"UKR"},GBR:{fillKey:"GBR"},VAT:{fillKey:"VAT"},RSB:{fillKey:"RSB"},IMN:{fillKey:"IMN"},MNE:{fillKey:"MNE"},kosovo:{fillKey:"kosovo"},GRL:{fillKey:"GRL"}},element:this.$container.get(0),projection:"mercator",done:this._handleMapReady.bind(this)})}function t(){$.getJSON("scripts/dataMock.json",function(e){return n.push(e),console.log(n),n})}var i=i||{},r={scope:"world",responsive:!1,aspectRatio:.5625,projection:"equirectangular",dataType:"json",data:{},done:function(){},fills:{defaultFill:"#ABDDA4"},filters:{},geographyConfig:{dataUrl:null,hideAntarctica:!0,hideHawaiiAndAlaska:!1,borderWidth:1,borderOpacity:1,borderColor:"#FDFDFD",popupTemplate:function(e,o){return'<div class="hoverinfo"><strong>'+e.properties.name+"</strong></div>"},popupOnHover:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1},projectionConfig:{rotation:[97,0]},bubblesConfig:{borderWidth:2,borderOpacity:1,borderColor:"#FFFFFF",popupOnHover:!0,radius:null,popupTemplate:function(e,o){return'<div class="hoverinfo"><strong>'+o.name+"</strong></div>"},fillOpacity:.75,animate:!0,highlightOnHover:!0,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightBorderOpacity:1,highlightFillOpacity:.85,exitDelay:100,key:JSON.stringify},arcConfig:{strokeColor:"#DD1C77",strokeWidth:1,arcSharpness:1,animationSpeed:600,popupOnHover:!1,popupTemplate:function(e,o){return o.origin&&o.destination&&o.origin.latitude&&o.origin.longitude&&o.destination.latitude&&o.destination.longitude?'<div class="hoverinfo"><strong>Arc</strong><br>Origin: '+JSON.stringify(o.origin)+"<br>Destination: "+JSON.stringify(o.destination)+"</div>":o.origin&&o.destination?'<div class="hoverinfo"><strong>Arc</strong><br>'+o.origin+" -> "+o.destination+"</div>":""}}};i={selectors:{zoom:{button:".zoom-button",info:".zoom-info"},subunit:".datamaps-subunit",map:"#main-map"},colors:{red:"#BB190D",white:"#FFFFFF",lightGrey:"#D0D0D0",black:"#000000"}},e.prototype.init=function(){var e=this.datamap.svg.selectAll("path"),o=this.datamap.svg.selectAll(i.selectors.subunit);e.style("vector-effect","non-scaling-stroke"),o.call(d3.behavior.drag().on("dragend",function(){d3.event.sourceEvent.stopPropagation()})),this.scale.set=this._getScalesArray(),this.d3Zoom=d3.behavior.zoom().scaleExtent([1,this.scale.max]),this._displayPercentage(1),this.listen()},e.prototype.listen=function(){this.$buttons.off("click").on("click",this._handleClick.bind(this)),this.datamap.svg.call(this.d3Zoom.on("zoom",this._handleScroll.bind(this))).on("dblclick.zoom",null)},e.prototype.reset=function(){this._shift("reset")},e.prototype._handleScroll=function(){var e=d3.event.translate,o=d3.event.scale,t=this._bound(e,o);this.scrolled=!0,this._update(t.translate,t.scale)},e.prototype._handleClick=function(e){var o=$(e.target).data("zoom");this._shift(o)},e.prototype._shift=function(e){var o=[this.$container.width()/2,this.$container.height()/2],t=this.d3Zoom.translate(),i=[],r=[],l={x:t[0],y:t[1],k:this.d3Zoom.scale()},n;i=[(o[0]-l.x)/l.k,(o[1]-l.y)/l.k],"reset"==e?(l.k=1,this.scrolled=!0):l.k=this._getNextScale(e),r=[i[0]*l.k+l.x,i[1]*l.k+l.y],l.x+=o[0]-r[0],l.y+=o[1]-r[1],n=this._bound([l.x,l.y],l.k),this._animate(n.translate,n.scale)},e.prototype._bound=function(e,o){var t=this.$container.width(),i=this.$container.height();return e[0]=Math.min(t/i*(o-1),Math.max(t*(1-o),e[0])),e[1]=Math.min(0,Math.max(i*(1-o),e[1])),{translate:e,scale:o}},e.prototype._update=function(e,o){this.d3Zoom.translate(e).scale(o),this.datamap.svg.selectAll("g").attr("transform","translate("+e+")scale("+o+")"),this._displayPercentage(o)},e.prototype._animate=function(e,o){var t=this,i=this.d3Zoom;d3.transition().duration(350).tween("zoom",function(){var r=d3.interpolate(i.translate(),e),l=d3.interpolate(i.scale(),o);return function(e){t._update(r(e),l(e))}})},e.prototype._displayPercentage=function(e){var o;o=Math.round(Math.log(e)/Math.log(this.scale.max)*100),this.$info.text(o+"%")},e.prototype._getScalesArray=function(){for(var e=[],o=Math.log(this.scale.max),t=0;10>=t;t++)e.push(Math.pow(Math.E,.1*t*o));return e},e.prototype._getNextScale=function(e){var o=this.scale.set,t=this.d3Zoom.scale(),i=o.length-1,r,l=[];if(this.scrolled){for(r=0;i>=r;r++)l.push(Math.abs(o[r]-t));r=l.indexOf(Math.min.apply(null,l)),t>=o[r]&&i>r&&r++,"out"==e&&r>0&&r--,this.scrolled=!1}else r=this.scale.currentShift,"out"==e?r>0&&r--:i>r&&r++;return this.scale.currentShift=r,o[r]},o.prototype._handleMapReady=function(o){this.zoom=new e({$container:this.$container,datamap:o})};var l=new o,n=[];t(),console.log("the bubble: ",t());var s=[{name:"United Kingdom",heading:"Visit Britain`s sandy beaches",radius:2,main:!0,centered:"GBR",country:"GBR",fillKey:"black",href:"#"},{name:"Spain",heading:"Find the best Cava",radius:2,main:!1,centered:"ESP",country:"ESP",fillKey:"black",href:"#"},{name:"Germany",heading:"Break your speed record on the Autobahn",radius:2,main:!0,centered:"DEU",country:"DEU",fillKey:"black",href:"#"},{name:"France",heading:"Have you seen the lavender fields?",radius:2,main:!0,centered:"FRA",country:"FRA",fillKey:"black",href:"#"}];l.instance.bubbles(s,{popupTemplate:function(e,o){return'<div class="hoverinfo main-info"> <div class="main-pin"></div>'+o.name+"</div>"}}),l.instance.mainMarkers(s),l.instance.secondaryMarkers(s),window.addEventListener("resize",function(){console.log("resize ",l.instance.resize),l.instance.resize()})}();