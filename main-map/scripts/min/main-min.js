!function(){var e=e||{};e={template:{main:{marker:_.template('<div class="marker-main"><span class="main-pin">&nbsp;</span><span class="main-subunit"><%= country %></span><p class="main-copy"><%= copy %></p><a class="main-href" href="<%= link %>">&nbsp</a>'),listItem:_.template('<li class="list-item"> <span class="list-item-heading"><%= country %></span><span class="list-item-copy"><%= copy %></span><a class="list-item-link" href="<%= link %>">&nbsp</a></li>'),hover:_.template('<div class="marker-main"><span class="main-pin">&nbsp;</span><span class="main-subunit"><%= country %></span><p class="main-copy"><%= copy %></p><a class="main-href" href="<%= link %>">&nbsp</a>')},secondary:{marker:_.template('<div class="secondary-marker-root"><div class="secondary-marker-wrapper"><div class="secondary-marker-content"><a href="<%= link %>"><span class="secondary-marker-content-heading">&nbsp;&nbsp;A guide to&nbsp;&nbsp;</span><span class="secondary-marker-content-copy"><%= country %></span></a></div></div><div class="secondary-marker-tip-container"><div class="secondary-marker-tip"></div></div></div>'),listItem:_.template('<li class="list-item"> <span class="list-item-heading"><%= country %></span><a class="list-item-link" href="<%= link %>">&nbsp</a></li>'),hover:_.template('<div class="popup-marker-secondary"><a href="<%= link %>"><span class="content-heading">&nbsp;&nbsp;A guide to&nbsp;&nbsp;</span><%= country %></div></a><div class="popup-marker-secondary-tip-container"><div class="popup-marker-secondary-tip"></div></div>')}},style:"mapbox://styles/sparkdigitaldesign/ciomog30c0019dgm46h7b8gnd",token:"pk.eyJ1Ijoic3BhcmtkaWdpdGFsZGVzaWduIiwiYSI6ImNpb2xsaWk0ZzAwMmh2dm02NGh0aGlnMjIifQ.emvmxCPCZlpQ0ovvxp0F-g",url:{coverage:"data/coverage.geojson",destinations:"data/destinations.geojson"},className:{marker:{main:"vdf-marker-main",secondary:"vdf-marker-secondary",normal:"vdf-marker"},pin:{main:"main-marker-pin",secondary:"secondary-marker-pin"}},selector:{marker:{main:".vdf-marker-main",secondary:".vdf-marker-secondary",normal:".vdf-marker"},list:{main:".destinations__list--main",secondary:".destinations__list--secondary"},button:".roaming__coverage",popup:".leaflet-popup-content"},svg:{dot:"images/dot.svg",empty:"images/empty.svg"},delayOpacity:function(e,a,n){$(e).each(function(e){$(this).delay(40*e)[a](n)})},setHtml:function(a){if(a.properties.destination&&"main"===a.properties.destination&&a.properties.content){var n=e.template.main.marker({country:a.properties.sr_subunit,copy:a.properties.content.copy,link:a.properties.content.href});return n}if(a.properties.destination&&"secondary"===a.properties.destination&&a.properties.content){var t=e.template.secondary.marker({country:a.properties.sr_subunit,link:a.properties.href});return t}return""},setClassName:function(a){return a.properties.destination&&"main"===a.properties.destination?e.className.marker.main:a.properties.destination&&"secondary"===a.properties.destination?e.className.marker.secondary:e.className.marker.normal},drawMap:function(a){s.addData(this.getGeoJSON()),this.eachLayer(function(a){var n=a.toGeoJSON();"main"===n.properties.destination?($(e.selector.list.main).append(e.template.main.listItem({country:n.properties.sr_subunit,copy:n.properties.content.copy,link:n.properties.content.href})),a._icon.src=e.svg.dot,a._icon["class"]=e.className.pin.main,a.bindPopup(e.template.main.hover({country:n.properties.sr_subunit,copy:n.properties.content.copy,link:n.properties.content.href}))):"secondary"===n.properties.destination?($(e.selector.list.main).append(e.template.secondary.listItem({country:n.properties.sr_subunit,link:n.properties.content.href})),a.bindPopup(e.template.secondary.hover({country:n.properties.sr_subunit,link:n.properties.href})),a._icon.src=e.svg.dot,a._icon["class"]=e.className.pin.secondary):(a.setIcon(L.mapbox.marker.icon({})),a._icon.src=e.svg.empty)})}},L.mapbox.accessToken=e.token;var a=L.latLng(-71.3,-165.937),n=L.latLng(82.118,189.843),t=L.latLngBounds(a,n),r=L.mapbox.map("map","mapbox.light",{attributionControl:!1,minZoom:4,maxZoom:7,maxBounds:t,style:e.style}).setView([44,16],5),s=L.geoJson(null,{pointToLayer:function(a,n){return L.marker(n,{icon:L.divIcon({className:e.setClassName(a),html:e.setHtml(a),iconSize:[100,40]})})}}).addTo(r),o=L.mapbox.featureLayer().loadURL(e.url.destinations).on("ready",e.drawMap).addTo(r);o.on("mouseover",function(e){var a=e.layer.feature.properties.destination;a&&(r.getZoom()<5&&"main"===a&&e.layer.openPopup(),r.getZoom()<6&&"secondary"===a&&e.layer.openPopup())}),o.on("mouseout",function(e){setTimeout(function(){e.layer.closePopup()},3e3)}),o.on("click",function(e){if(e.layer.feature.properties.content){var a=e.layer.feature.properties.content.href;window.open(a,"_self")}}),r.on("ready",function(){var a=L.mapbox.tileLayer("mapbox.light",{noWrap:!1},{minZoom:0,maxZoom:4,maxBounds:t}),n=L.mapbox.featureLayer().loadURL(e.url.coverage);layers=new L.LayerGroup([a,n]),new L.Control.MiniMap(layers,{width:300,position:"topright",aimingRectOptions:{color:"#333333",weight:3},shadowRectOptions:{color:"#c90000",weight:1,opacity:0,fillOpacity:0},centerFixed:[40.7842,-73.9919]}).addTo(r),$("."+e.className.marker.secondary).hide(),setTimeout(function(){$(e.selector.marker.normal).remove()},300)}),r.on("zoomend",function(){$(e.selector.popup).hide(),r.getZoom()>=5?e.delayOpacity(e.selector.marker.main,"fadeIn",100):e.delayOpacity(e.selector.marker.main,"fadeOut",100),r.getZoom()>=6?e.delayOpacity(e.selector.marker.secondary,"fadeIn",100):e.delayOpacity(e.selector.marker.secondary,"fadeOut",100)}),$(e.selector.marker.secondary).each(function(e){$(this).delay(400*e).fadeIn(300)}),$(e.selector.button).on("click",function(){r.setView([55,-8],3)}),L.mapbox.styleLayer(e.style).addTo(r),L.mapbox.featureLayer().loadURL(e.url.coverage).addTo(r)}();