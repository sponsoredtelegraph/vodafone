!function(){function e(){var e=L.mapbox.featureLayer().loadURL("data/coverage.geojson");console.log("data",e)}L.mapbox.accessToken="pk.eyJ1Ijoic3BhcmtkaWdpdGFsZGVzaWduIiwiYSI6ImNpb2xsaWk0ZzAwMmh2dm02NGh0aGlnMjIifQ.emvmxCPCZlpQ0ovvxp0F-g";var a=a||{},o=L.latLng(-71.3,-165.937),n=L.latLng(82.118,189.843),s=L.latLngBounds(o,n),t=L.mapbox.map("map","mapbox.light",{attributionControl:!1,zoomControl:!1,minZoom:4,maxZoom:7,maxBounds:s,style:"mapbox://styles/yozzo/cioei8vzc002yczmamm4yefeb"}).setView([44,16],5);L.control.zoom({position:"topright"}).addTo(t);var i=L.geoJson(null,{pointToLayer:function(e,a){function o(e){if(e.properties.destination&&"main"===e.properties.destination&&e.properties.content){var a='<div class="marker-main"><span class="main-pin">&nbsp;</span><span class="main-subunit">'+e.properties.sr_subunit+'</span><p class="main-copy">'+e.properties.content.copy+'</p><a class="main-href" href="'+e.properties.content.href+'">&nbsp</a>';return a}if(e.properties.destination&&"secondary"===e.properties.destination&&e.properties.content){var o='<div class="secondary-marker-root"><div class="secondary-marker-wrapper"><div class="secondary-marker-content"><a href="'+e.properties.content.href+'"><span class="secondary-marker-content-heading">&nbsp;&nbsp;A guide to&nbsp;&nbsp;</span><span class="secondary-marker-content-copy">'+e.properties.sr_subunit+'</span></a></div></div><div class="secondary-marker-tip-container"><div class="secondary-marker-tip"></div></div></div>';return o}return""}function n(){return e.properties.destination&&"main"===e.properties.destination?"vdf-marker-main":e.properties.destination&&"secondary"===e.properties.destination?"vdf-marker-secondary":"vdf-marker"}return L.marker(a,{icon:L.divIcon({className:n(e),html:o(e),iconSize:[100,40]})})}}).addTo(t),r=L.mapbox.featureLayer().loadURL("data/destinations.geojson").on("ready",function(e){i.addData(this.getGeoJSON()),this.eachLayer(function(e){if("main"===e.toGeoJSON().properties.destination){var a=e.toGeoJSON();$(".destinations__list--main").append('<li class="list-item"> <span class="list-item-heading">'+a.properties.sr_subunit+'</span><span class="list-item-copy">'+a.properties.content.copy+'</span><a class="list-item-link" href="'+a.properties.content.href+'">&nbsp</a></li>'),e._icon.src="images/dot.svg",e._icon["class"]="main-marker-pin",e.bindPopup('<div class="marker-main"><span class="main-pin">&nbsp;</span><span class="main-subunit">'+a.properties.sr_subunit+'</span><p class="main-copy">'+a.properties.content.copy+'</p><a class="main-href" href="'+a.properties.content.href+'">&nbsp</a>')}else"secondary"===e.toGeoJSON().properties.destination?($(".destinations__list--secondary").append('<li class="list-item"> <span class="list-item-heading">'+e.toGeoJSON().properties.sr_subunit+'</span><a class="list-item-link" href="'+e.toGeoJSON().properties.content.href+'">&nbsp</a></li>'),e.bindPopup('<div class="popup-marker-secondary"><a href="'+e.toGeoJSON().properties.content.href+'"><span class="content-heading">&nbsp;&nbsp;A guide to&nbsp;&nbsp;</span>'+e.toGeoJSON().properties.sr_subunit+'</div></a><div class="popup-marker-secondary-tip-container"><div class="popup-marker-secondary-tip"></div></div>'),e._icon.src="images/dot.svg"):(e.setIcon(L.mapbox.marker.icon({})),e._icon.src="images/empty.svg")})}).addTo(t);r.on("mouseover",function(e){var a=e.layer.feature.properties.destination;a&&(t.getZoom()<5&&"main"===a&&e.layer.openPopup(),t.getZoom()<6&&"secondary"===a&&e.layer.openPopup())}),r.on("mouseout",function(e){setTimeout(function(){e.layer.closePopup()},3e3)}),r.on("click",function(e){if(e.layer.feature.properties.content){var a=e.layer.feature.properties.content.href;window.open(a)}}),t.on("ready",function(){var e=L.mapbox.tileLayer("mapbox.light",{noWrap:!1},{minZoom:0,maxZoom:4,maxBounds:s}),a=L.mapbox.featureLayer().loadURL("data/coverage.geojson");layers=new L.LayerGroup([e,a]),new L.Control.MiniMap(layers,{width:300,position:"topright",aimingRectOptions:{color:"#333333",weight:3},shadowRectOptions:{color:"#c90000",weight:1,opacity:0,fillOpacity:0},centerFixed:[40.7842,-73.9919]}).addTo(t),$(".vdf-marker-secondary").hide(),setTimeout(function(){$(".vdf-marker").remove()},300)}),t.on("zoomend",function(){$(".leaflet-popup-content").hide(),t.getZoom()>=5?$(".vdf-marker-main").each(function(e){$(this).delay(40*e).fadeIn(100)}):$(".vdf-marker-main").each(function(e){$(this).delay(40*e).fadeOut(100)}),t.getZoom()>=6?$(".vdf-marker-secondary").each(function(e){$(this).delay(40*e).fadeIn(100)}):$(".vdf-marker-secondary").each(function(e){$(this).delay(40*e).fadeOut(100)})}),$(".vdf-marker-secondary").each(function(e){$(this).delay(400*e).fadeIn(300)}),$(".roaming__coverage").on("click",function(){t.setView([55,-8],3)}),L.mapbox.styleLayer("mapbox://styles/sparkdigitaldesign/ciomog30c0019dgm46h7b8gnd").addTo(t),L.mapbox.featureLayer().loadURL("data/coverage.geojson").addTo(t),e()}();